{% ckan_extends %}
 
{% block resource_actions_inner %}
    {{super()}}
    
     {% if res.vectorstorer_resource and res.format=='DB_TABLE' %}
	 
	 
	  
	   <li>{% link_for _('Export'), controller='ckanext.vectorstorer.controllers.export:ExportController', action='export',operation='index', id=pkg.name, resource_id=res.id, class_='btn', icon='magic' %}</li>


    {% endif %}
    {% if res.format=="WMS" and res.vectorstorer_resource %}
	<li>{% link_for _('Edit Style'), controller='ckanext.vectorstorer.controllers.style:StyleController', action='edit_current_sld', id=pkg.name, resource_id=res.id,operation='show', class_='btn', icon='magic' %}</li>
    {% endif %}
    
    {% if not res.vectorstorer_resource %}
       {% if h.vectorstore_is_in_vectorstore(c.pkg.id, c.resource_id) %}
            <button class="btn btn-success btn-disabled"><i class="fa fa-globe"></i><i class="fa fa-check"></i> GeoData imported</button>
        {% else %}
            {# Add check for geo formats #}
            <a class="btn btn-success" href="#" onclick="upload()"><i class="fa fa-upload"></i><i class="fa fa-globe"></i> Import GeoData</a>
        {% endif %}
    {% elif c.resource.parent_resource_id %}
        {% if res.format=="WMS" and res.vectorstorer_resource %}
          <a class="btn btn-success" href="{{ h.url_for(controller='package', action='resource_read', id=c.pkg.id, resource_id=c.resource.parent_resource_id) }}"><i class="fa fa-files-o"></i><i class="fa fa-globe"></i> View Geo-Data</a>        
        {% elif res.format=="DB_TABLE" and res.vectorstorer_resource %}
          <a class="btn btn-success" href="{{ h.url_for(controller='package', action='resource_read', id=c.pkg.id, resource_id=c.resource.parent_resource_id) }}"><i class="fa fa-level-up"></i><i class="fa fa-globe"></i> View Geo-Source</a> 
        {% endif %}
    {% endif %}
{% endblock %}

{% block scripts %}    
{{ super() }}
  <script>
    var upload = function() {
      do {
        var epsg = prompt("Please enter the EPSG code for the projection of the data (without \"EPSG:\"/numbers only)", "4326");
      }
      while (epsg && !parseInt(epsg))
    
      if (!epsg) return;
      $.get("/api/vector/publish?resource_id={{ c.resource.id }}&projection=" + epsg, function() {
          $('.flash-messages').append('<div class=\"alert fade in alert-info\">Submitted resource {{ c.resource.id }} to Datastore and GeoServer using EPSG:' + epsg + '<a class=\"close\" href=\"#\">&#215;</a></div>');
        }).fail(function(jqXHR, errorStatus, errorThrown) {
          $('.flash-messages').append('<div class=\"alert fade in alert-error\">Could not submit resource {{ c.resource.id }} to Datastore and GeoServer. Error: ' + errorStatus + ' <a class=\"close\" href=\"#\">&#215;</a></div>');
        });     
}
  </script>
{% endblock %}

